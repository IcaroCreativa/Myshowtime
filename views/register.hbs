<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="shortcut icon" type="image/x-icon" href="/logo.ico">
    <title>Myshowtime Login</title>
</head>
<body id="bg_img">
    
    
{{!-----------------REGISTER----- --}}
  <div class="flex flex-col items-center justify-center px-6 py-8 mx-auto md:h-screen lg:py-0">
      <a href="#" class="flex items-center mb-6 text-2xl font-semibold text-white dark:text-white">
          <img class="w-8 h-8 mr-2" src="https://flowbite.s3.amazonaws.com/blocks/marketing-ui/logo.svg" alt="logo">
          MyShowTime    
      </a>
      <div class="w-full bg-white rounded-lg shadow dark:border md:mt-0 sm:max-w-md xl:p-0 dark:bg-gray-800 dark:border-gray-700">
          <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
              <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white">
                  Create and account
              </h1>
              <form class="space-y-4 md:space-y-6" action="/">
                   <div>
                      <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your Name</label>
                      <input  min="3" max="50" type="text" name="name" id="name" class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="name@company.com" required="">
                  </div>
                  
                  <div>
                      <label for="email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your email</label>
                      <input onblur="verify_email()" type="email" name="email" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="name@company.com" required="">
                      <p id="error-message1" class="text-red-600 text-sm italic mb-2 mt-1 ml-1"></p>
                  </div>
                  <div>
                      <label for="password" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Password</label>
                      <input onclick="clear_error_message()" type="password" name="password" id="password" placeholder="••••••••" minlength="8"  title="You must enter at least 8 characters" class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required="">
                  </div>
                  <div>
                      <label for="confirm-password" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Confirm password</label>
                      <input onclick="clear_error_message()" type="password" name="confirm-password" id="confirm-password" placeholder="••••••••" minlength="8" title="You must enter at least 8 characters" class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required="">
                      <p id="error-message" class="text-red-600 text-sm italic mb-2"></p>
                  </div>
                  <div class="flex items-start">
                      <div class="flex items-center h-5">
                        <input id="terms" aria-describedby="terms" type="checkbox" class="w-4 h-4 border border-gray-300 rounded bg-gray-50 focus:ring-3 focus:ring-primary-300 dark:bg-gray-700 dark:border-gray-600 dark:focus:ring-primary-600 dark:ring-offset-gray-800" required="">
                      </div>
                      <div class="ml-3 text-sm">
                        <label for="terms" class="font-light text-gray-500 dark:text-gray-300">I accept the <a class="font-medium text-primary-600 hover:underline dark:text-primary-500" href="#">Terms and Conditions</a></label>
                      </div>
                  </div>
                  <button type="submit" class="w-full text-white bg-blue-600 hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">Create an account</button>
                  <p class="text-sm font-light text-gray-500 dark:text-gray-400">
                      Already have an account? <a href="#" class="font-medium text-primary-600 hover:underline dark:text-primary-500">Login here</a>
                  </p>
              </form>
          </div>
      </div>
  </div>
</div>
 
</body>
</html>




<script>

function clear_error_message(){
    
    email=document.getElementById('email').value
    password=document.getElementById('password').value
    error_message=document.getElementById('error-message')
    if(error_message.innerText=='The passwords do not match!'){
    error_message.innerHTML='';
    password.innerHTML='';
    document.getElementById('confirm-password').value=''
     document.getElementById('password').value=''
      document.getElementById('password').style.backgroundColor = '#f8fafc';
      document.getElementById('confirm-password').style.backgroundColor = '#f8fafc';

    }else{}
}


  function checkPassword(event) {
    // Récupération des valeurs des champs de mot de passe
    var password = document.getElementById("password").value;
    var confirmPassword = document.getElementById("confirm-password").value;

    // Vérification si les mots de passe sont identiques
    if (password !== confirmPassword) {
      document.getElementById("error-message").innerHTML = "The passwords do not match!";
      document.getElementById('password').style.backgroundColor = '#fde68a';
      document.getElementById('confirm-password').style.backgroundColor = '#fde68a';
      event.preventDefault(); // Empêche l'envoi du formulaire
      return false;
    }
    create_user();
    
  }

  // Ajout d'un écouteur d'événement pour exécuter la fonction de vérification lorsque le formulaire est soumis
  var form = document.querySelector("form");
  form.addEventListener("submit", checkPassword);


 function verify_email(email){
    error_message1=document.getElementById('error-message1')
    input=document.getElementById('email')
    email=document.getElementById('email').value
    var myHeaders = new Headers();
    myHeaders.append("Content-Type", "application/json");

    var raw = JSON.stringify({
    "email": email
    });

    var requestOptions = {
    method: 'POST',
    headers: myHeaders,
    body: raw,
    redirect: 'follow'
    };

    fetch("http://localhost:3000/email_verify", requestOptions)
    .then(response => response.text())
    .then(result => {
        if (result=='true'){
        error_message1.innerText='Email exists!'
        input.style.backgroundColor = '#fde68a';
        }
        else{
            error_message1.innerText=''
            input.style.backgroundColor = '#f8fafc';
            
        }
        
        })
    .catch(error => console.log('error', error));
 }



function create_user(){
  
    name=document.getElementById('name').value
    email=document.getElementById('email').value
    password=document.getElementById('password').value
    favorites=[]
    isadmin="false"
    var myHeaders = new Headers();
    myHeaders.append("content-Type", "application/json");

    var raw = JSON.stringify({
    "name": name,
    "email": email,
    "password": password,
    "favorites": favorites,
    "isadmin": isadmin
    });

    var requestOptions = {
    method: 'POST',
    headers: myHeaders,
    body: raw,
    redirect: 'follow'
    };

    fetch("http://localhost:3000/user", requestOptions)
    .then(response => response.json())
    .then(result => { console.log(result)
        })
    .catch(error => console.log('error', error));

    }

</script>


<style>
#bg_img{
    background-image: url("https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1740&q=80");
    background-size: cover;
    background-repeat: none;
    }
</style>